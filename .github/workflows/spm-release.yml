name: Release to SPM
on:
    workflow_dispatch:
        inputs:
            releaseVersion:
                description: 'The version/tag of the release'
                required: true
            commitHash:
                description: 'The commit hash if included in Agora filename'
                required: false

jobs:
    update_spm:
        runs-on: ubuntu-latest
        steps:

          - name: Checkout main branch
            uses: actions/checkout@v4
            with:
                ref: main

          - name: Remove existing framework and docs
            run: |
                rm -rf axeDevToolsXCUI.*

          - name: Download latest XCUI framework & DocC archive
            env:
                DQ_AGORA_KEY: ${{ secrets.DQ_AGORA_KEY }}
            run: |
                sh .github/scripts/DownloadLatestFrameworkAndDocs.sh ${{ github.event.inputs.releaseVersion }} ${{ github.event.inputs.commitHash }}

          - name: Commit changes
            run: |
                git config user.name "deque-mobileteam"
                git config user.email "mobileteam@deque.com"
                git add axeDevToolsXCUI.*
                git commit -m "chore: release ${{ github.event.inputs.releaseVersion }}"
                git status

    